<!DOCTYPE html>
<html lang="en">
  <%- include('partials/head.ejs') %>

  <body>
    <%- include('partials/navbar.ejs') %>
    <div class="container py-4">
      <div class="row">
        <div class="col-sm-12">
          <% if(typeof(alerts) == 'object' && alerts) { %>
            <% alerts.forEach((alert) => { %>
              <% if(alert.type == 'success') { %>  
                <div class="alert alert-success" role="alert">
              <% } else {  %>
                <div class="alert alert-danger" role="alert">
              <% } %>
                  <%= alert.msg %>
                </div>
            <% }) %>
          <% } %>

          <% if(typeof(messages) == 'object' && messages.length !== 0) { %>
            <% messages.forEach((message) => { %>
              <div class="blog-post">
                <h2 class="blog-post-title"><%= message.title %></h2>
                <% if(typeof(user) == 'object' && user) { %>
                  <p class="blog-post-meta">
                    <%= user.membership_status == 'Admin' || user.membership_status == 'Member' ? message.timestamp + ' by' : '' %>
                    <%= user.membership_status == 'Admin' ? message.user.first_name : 'Anonymous' %>
                  </p>
                <% } %>
                <p><%= message.text %></p>
                <% if (typeof(user) == 'object' && user.membership_status == 'Admin') { %>
                  <a class="text-danger" data-toggle="modal" data-target="#deleteMessageModal" href="" onclick="deleteMessage('<%= message._id %>')">Delete</a>
                <% } %>
              </div>
            <% }) %>
          <% } else if(typeof(user) == 'object' && user) { %>
            <h5>No messages :(</h5>
          <% } %>
        </div>
      </div>
    </div>

    <footer class="blog-footer">
      <p>Members Only is &copy; David Ornellas, created as part of The Odin Project curriculum</p>
      <p><a href="http://github.com/ornellasd">Check out my GitHub</a> <i class="fa fa-github"></i></p>
      <a href="#">Back to top</a>
      </p>
    </footer>
    <%- include('sign-up-modal.ejs') %>
    <%- include('log-in-modal.ejs') %>
    <%- include('new-message-modal.ejs') %>
    <%- include('delete-message-modal.ejs') %>
    <script src="/javascripts/script.js"></script>
  </body>
</html>
